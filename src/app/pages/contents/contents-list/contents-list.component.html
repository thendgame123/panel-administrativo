<div class="contents-content">
  <div class="contents-wrapper">
    <div class="content-header">
      <div class="header-left">
        <h2 class="page-title">Contenidos</h2>
        <p class="page-description">Administra el contenido multimedia para las pantallas interactivas</p>
      </div>

    @if (role === 'admin') {
      <div class="header-right">
        <button class="btn-nuevo-content" [routerLink]="['/admin','contents','nuevo']">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="12" y1="5" x2="12" y2="19"></line>
            <line x1="5" y1="12" x2="19" y2="12"></line>
          </svg>
          Nuevo Contenido
        </button>
      </div>
    }

    </div>

    <!-- Filtros -->
    <div class="filters-card">
      <div class="filter-group">
        <label class="filter-label">Buscar contenido</label>
        <div class="search-input-wrapper">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="search-icon">
            <circle cx="11" cy="11" r="8"></circle>
            <path d="m21 21-4.35-4.35"></path>
          </svg>
          <input 
            type="text" 
            class="filter-input" 
            placeholder="Buscar por título..."
            [(ngModel)]="searchText"
            (input)="onFilterChange()"
          />
        </div>
      </div>

      <div class="filter-group">
        <label class="filter-label">Categoría</label>
        <select 
          class="filter-select"
          [(ngModel)]="selectedCategory"
          (change)="onFilterChange()"
        >
          <option value="">Todas las categorías</option>
          <option *ngFor="let cat of categories" [value]="cat">{{ cat }}</option>
        </select>
      </div>

      <div class="filter-group">
        <label class="filter-label">Estado</label>
        <select 
          class="filter-select"
          [(ngModel)]="selectedStatus"
          (change)="onFilterChange()"
        >
          <option value="">Todos</option>
          <option value="active">Activo</option>
          <option value="inactive">Inactivo</option>
        </select>
      </div>
    </div>

    <!-- Tabla de contenidos -->
    <div class="table-card">
      <div class="table-responsive">
        <table class="contents-table">
          <thead>
            <tr>
              <th class="th-contenido">Contenido</th>
              <th class="th-categoria">Categoría</th>
              <th class="th-vigencia">Vigencia</th>
              <th class="th-ubicacion">Ubicación</th>
              <th class="th-multimedia">Multimedia</th>
              <th class="th-estado">Estado</th>
              <th class="th-acciones">Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let content of filteredContents" class="table-row">
              <!-- Contenido -->
              <td class="td-contenido">
                <div class="content-info">
                  <h4 class="content-title">{{ content.title }}</h4>
                  <p class="content-description">{{ content.description }}</p>
                </div>
              </td>

              <!-- Categoría -->
              <td class="td-categoria">
                <span class="category-badge">{{ content.category }}</span>
              </td>

              <!-- Vigencia -->
              <td class="td-vigencia">
                <div class="vigencia-info">
                  <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                    <line x1="16" y1="2" x2="16" y2="6"></line>
                    <line x1="8" y1="2" x2="8" y2="6"></line>
                    <line x1="3" y1="10" x2="21" y2="10"></line>
                  </svg>
                  <span class="vigencia-text">{{ formatDate(content.startDate) }} - {{ formatDate(content.endDate) }}</span>
                </div>
              </td>

              <!-- Ubicación -->
              <td class="td-ubicacion">
                <div class="ubicacion-info">
                  <div class="ships-container" [class.expanded]="isShipsExpanded(content.id)">
                    <!-- Ubicaciones visibles (máximo 3) -->
                    <div class="ship-item" *ngFor="let ship of getVisibleShips(content.ships)">
                      <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M2 21c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1 .6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1"></path>
                        <path d="M19.38 20A11.6 11.6 0 0 0 21 14l-9-4-9 4c0 2.9.94 5.34 2.81 7.76"></path>
                        <path d="M19 13V7a2 2 0 0 0-2-2H7a2 2 0 0 0-2 2v6"></path>
                        <path d="M12 10v4"></path>
                        <path d="M12 2v3"></path>
                      </svg>
                      <span>{{ ship }}</span>
                    </div>

                    <!-- Ubicaciones ocultas (cuando hay más de 3) -->
                    <div class="ship-item" *ngFor="let ship of getHiddenShips(content.ships)" [class.hidden]="!isShipsExpanded(content.id)">
                      <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M2 21c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1 .6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1"></path>
                        <path d="M19.38 20A11.6 11.6 0 0 0 21 14l-9-4-9 4c0 2.9.94 5.34 2.81 7.76"></path>
                        <path d="M19 13V7a2 2 0 0 0-2-2H7a2 2 0 0 0-2 2v6"></path>
                        <path d="M12 10v4"></path>
                        <path d="M12 2v3"></path>
                      </svg>
                      <span>{{ ship }}</span>
                    </div>
                  </div>

                  <!-- Botón de expansión (+) cuando hay más de 3 ubicaciones -->
                  <button *ngIf="hasMoreShips(content.ships)" 
                          class="btn-expand-ships"
                          (click)="toggleShipsExpanded(content.id)"
                          [title]="isShipsExpanded(content.id) ? 'Ver menos' : 'Ver más ubicaciones'">
                    {{ isShipsExpanded(content.id) ? '−' : '+' }}
                  </button>
                </div>
              </td>

              <!-- Multimedia -->
              <td class="td-multimedia">
                <div class="multimedia-badges">
                  <span class="media-badge" *ngIf="content.imageFile">
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                      <circle cx="8.5" cy="8.5" r="1.5"></circle>
                      <polyline points="21 15 16 10 5 21"></polyline>
                    </svg>
                    Imagen
                  </span>
                  <span class="media-badge" *ngIf="content.videoFile">
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <polygon points="23 7 16 12 23 17 23 7"></polygon>
                      <rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect>
                    </svg>
                    Video
                  </span>
                  <span class="media-badge" *ngIf="content.pdfFile">
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                      <polyline points="14 2 14 8 20 8"></polyline>
                      <line x1="12" y1="18" x2="12" y2="12"></line>
                      <line x1="9" y1="15" x2="15" y2="15"></line>
                    </svg>
                    PDF
                  </span>
                </div>
              </td>

              @if (role === 'admin') {
                              <!-- Estado -->
              <td class="td-estado">
                <div class="estado-wrapper">
                  <label class="toggle-switch-small">
                    <input 
                      type="checkbox" 
                      [checked]="content.isActive"
                      (change)="onToggleEstado(content)"
                    />
                    <span class="toggle-slider-small"></span>
                  </label>
                  <span class="estado-badge" [class.activo]="content.isActive" [class.inactivo]="!content.isActive">
                    {{ content.isActive ? 'Activo' : 'Inactivo' }}
                  </span>
                </div>
              </td>
              }

              @if (role === 'reportero') {
                              <!-- Estado -->
              <td class="td-estado">
                <div class="estado-wrapper">
                  <span class="estado-badge" [class.activo]="content.isActive" [class.inactivo]="!content.isActive">
                    {{ content.isActive ? 'Activo' : 'Inactivo' }}
                  </span>
                </div>
              </td>
              }              

              @if (role=== 'admin') {
                              <!-- Acciones -->
              <td class="td-acciones">
                <div class="acciones-wrapper">
                  <button class="btn-action btn-editar" (click)="onEditarContenido(content)" title="Editar">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                      <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                    </svg>
                  </button>
                  <button class="btn-action btn-eliminar" (click)="onEliminarContenido(content)" title="Eliminar">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <polyline points="3 6 5 6 21 6"></polyline>
                      <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                    </svg>
                  </button>
                </div>
              </td>
              }

              @if (role=== 'reportero') {
                              <!-- Acciones -->
              <td class="td-acciones">
                <div class="acciones-wrapper">
                  <button class="btn-action btn-editar" (click)="onVerContenido(content)" title="Ver">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                      viewBox="0 0 24 24" fill="none" stroke="currentColor"
                      stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <circle cx="12" cy="12" r="3"></circle>
                      <path d="M2.05 12a9.94 9.94 0 0 1 19.9 0a9.94 9.94 0 0 1-19.9 0z"></path>
                    </svg>              
                  </button>
                </div>
              </td>
              }              
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Paginación -->
      <div class="table-footer">
        <p class="table-info">Mostrando {{ filteredContents.length }} de {{ contents.length }} contenidos</p>
      </div>
    </div>
  </div>
</div>